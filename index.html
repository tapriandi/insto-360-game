<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no">
  <title>360 Games | Insto</title>
  <link href="https://fonts.googleapis.com/css?family=Julius+Sans+One" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>
  <script src="./js/three.min.js"></script>
  <script src="./js/panolens.min.js"></script>
  <script src="./js/typed.min.js"></script>

  <div id="progress" class="finish"></div>

  <div id="dialog">
    <div id="typed">Insto Present</div>
  </div>

  <script>
    var panorama, panorama_area, viewer, typed, typed;
    var rulesInfospot, valveInfospot, endingInfospot;
    var progressElement = document.querySelector('#progress');
    var tweeningDelay = 300,
      typeStartDelay = 1000,
      typeSpeed = 50;

    var paragraphs = {

      // welcome: ['360 Games', 'A Journey to find the <strong>insto bottle</strong>', 'Here we go'],
      // rules: ['1.  Find the insto bottle imediately <br> 2.  Press and hold the left click for moving <br> 3.  Click <b>insto bottle<b> to collect your point',
      // ],
      welcome: ['welcome'],
      rules: ['rules'],
      ending: ["let's play!"]

    };

    // Patch for typed.js of cutting back-to-back words
    for (var section in paragraphs) {
      if (paragraphs.hasOwnProperty(section)) {
        paragraphs[section].unshift('');
        paragraphs[section].push('');
      }
    }

    function delayExecute(func, delay) {
      setTimeout(func, delay);
    }

    function onLoad() {
      type(paragraphs.welcome, onWelcomeComplete, 2000);
    }

    function onEnter(event) {
      progressElement.style.width = 0;
      progressElement.classList.remove('finish');
    }

    function onProgress(event) {
      var progress = event.progress.loaded / event.progress.total * 100;
      progressElement.style.width = progress + '%';
      if (progress === 100) {
        progressElement.classList.add('finish');
      }
    }

    function onWelcomeComplete() {
      delayExecute(rulesInfospot.focus.bind(rulesInfospot), tweeningDelay);
      type(paragraphs.rules, onRulesTourComplete);
    }

    function onRulesTourComplete() {
      delayExecute(valveInfospot.focus.bind(valveInfospot), tweeningDelay);
      type(paragraphs.ending, onTopboxTourComplete);
    }

    function onTopboxTourComplete() {
      delayExecute(endingInfospot.focus.bind(endingInfospot), tweeningDelay);
      viewer.OrbitControls.enabled = true;
    }

    // typing text
    function type(stringArray, onComplete, startDelay) {
      onComplete = onComplete || function () {};
      startDelay = startDelay >= 0 ? startDelay : typeStartDelay;
      typed = new Typed("#typed", {
        strings: stringArray,
        typeSpeed: typeSpeed,
        showCursor: false,
        startDelay: startDelay,
        onComplete: onComplete
      });
    }

    
    // Infospots
    rulesInfospot = new PANOLENS.Infospot();
    valveInfospot = new PANOLENS.Infospot();
    endingInfospot = new PANOLENS.Infospot(10e-7); // Make it not visible

    rulesInfospot.position.set(4610.04, 1280.07, 1431.29);
    valveInfospot.position.set(4637.61, -798.12, -1671.24);

    rulesInfospot.addHoverText('Rules', 50);

    // Panorama
    // panorama = new PANOLENS.EmptyPanorama();
    panorama = new PANOLENS.ImagePanorama('./assets/1.jpg');
    // panorama_area = new PANOLENS.ImagePanorama('./assets/7.jpg');
    panorama_area = new PANOLENS.ImagePanorama('./assets/2.jpg');
    panorama.addEventListener('progress', onProgress);
    panorama.addEventListener('load', onLoad);
    panorama.addEventListener('enter', onEnter);
    panorama.add(rulesInfospot, valveInfospot, endingInfospot);
    panorama.link( panorama_area, new THREE.Vector3(4637.61, -798.12, -1071.24) );
    panorama_area.link( panorama, new THREE.Vector3(4637.61, -798.12, -1071.24) );

    // Viewer
    viewer = new PANOLENS.Viewer({
      controlBar: false,
      initialLookAt: new THREE.Vector3(0, 0, 5000)
    });
    viewer.OrbitControls.enabled = false;
    viewer.add(panorama, panorama_area);


    var posterInfospot = new PANOLENS.Infospot(2000, 'https://images-na.ssl-images-amazon.com/images/I/91nELBuo3kL._RI_SX200_.jpg');
    posterInfospot.position.set(-4774.9, 474.16, -1375.02);
    panorama.add(posterInfospot);
    panorama_area.add(posterInfospot);
    

  </script>

  <div class="panolens-container">
    <canvas width="859" height="657" class="panolens-canvas"></canvas>
    <div class="panolens-infospot">Rules</div>
    <div class="panolens-infospot">Play</div>
  </div>


</body>

</html>